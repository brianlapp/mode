<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MFF Multi-Domain Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>üöÄ MFF Multi-Domain Popup Test</h1>
    
    <div class="test-section">
        <h2>Property Auto-Detection Test</h2>
        <p>This tests the new <code>ModePopup.init({ property: 'auto' })</code> functionality.</p>
        
        <button onclick="testAutoProperty()">Test Auto Property Detection</button>
        <button onclick="testMFFDirect()">Test MFF Direct</button>
        <button onclick="testPropertyResolve()">Test Property Resolve API</button>
        <button onclick="clearLog()">Clear Log</button>
        
        <div id="testLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>Current Status</h2>
        <p><strong>Hostname:</strong> <span id="hostname"></span></p>
        <p><strong>Expected Property:</strong> <span id="expectedProperty"></span></p>
        <p><strong>Test Environment:</strong> Local file (will resolve as unknown property)</p>
    </div>

    <!-- Load the production popup script -->
    <script src="https://mode-dash-production.up.railway.app/popup.js"></script>
    
    <script>
        // Display current hostname info
        document.getElementById('hostname').textContent = window.location.hostname || 'localhost';
        document.getElementById('expectedProperty').textContent = window.location.hostname === 'modefreefinds.com' ? 'mff' : 'unknown (will fallback to mff)';
        
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        async function testAutoProperty() {
            log('üß™ Testing ModePopup.init({ property: "auto" })...');
            
            try {
                // Initialize with auto property detection
                await ModePopup.init({
                    property: 'auto',
                    placement: 'thankyou',
                    debug: true
                });
                
                log('‚úÖ Auto property detection initialized successfully');
                log('üéØ Popup should appear with brand targeting enabled');
                
            } catch (error) {
                log('‚ùå Error with auto property: ' + error.message);
            }
        }
        
        async function testMFFDirect() {
            log('üß™ Testing direct MFF property...');
            
            try {
                await ModePopup.init({
                    property: 'mff',
                    placement: 'thankyou',
                    debug: true
                });
                
                log('‚úÖ Direct MFF property initialized successfully');
                
            } catch (error) {
                log('‚ùå Error with MFF direct: ' + error.message);
            }
        }
        
        async function testPropertyResolve() {
            log('üß™ Testing /api/properties/resolve endpoint...');
            
            try {
                const response = await fetch('https://mode-dash-production.up.railway.app/api/properties/resolve?host=modefreefinds.com');
                const data = await response.json();
                
                if (response.ok) {
                    log('‚úÖ Property resolve success: ' + JSON.stringify(data, null, 2));
                } else {
                    log('‚ö†Ô∏è Property resolve response: ' + JSON.stringify(data, null, 2));
                }
                
            } catch (error) {
                log('‚ùå Error testing property resolve: ' + error.message);
            }
        }
        
        // Log when popup script loads
        log('üìÑ Page loaded, popup script ready for testing');
    </script>
</body>
</html>